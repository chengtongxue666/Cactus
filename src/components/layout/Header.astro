---
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { menuLinks } from "@/site.config";
---

<style lang="postcss">
.header-link {
  @apply relative px-4 py-2 transition-colors duration-200 hover:text-accent;

  &::after {
    @apply absolute bottom-0 left-1/2 h-[2px] w-0 bg-accent transition-all duration-300 content-[''];
  }

  &:hover::after {
    @apply left-0 w-full;
  }

  &[aria-current='page'] {
    @apply text-accent font-semibold;

    &::after {
      @apply left-0 w-full;
    }
  }
}

.logo {
  @apply transition-transform duration-300 hover:scale-110;
}

.mobile-menu {
  @apply fixed inset-0 z-40 flex flex-col items-center justify-center bg-bgColor/95 backdrop-blur-lg transition-all duration-300 ease-out;
}
</style>

<header class="group sticky top-0 z-50 mb-16 flex h-16 items-center justify-between bg-bgColor/80 px-4 backdrop-blur-md sm:px-8">
  <div class="flex items-center gap-8">
    <!-- Logo -->
    <a
      href="/"
      class="logo inline-flex items-center gap-3"
      aria-current={Astro.url.pathname === "/" ? "page" : false}
    >
      <img
        src="/logo256.avif"
        alt="猫&小窝 Logo"
        class="h-10 w-10 rounded-full border-2 border-accent sm:h-12 sm:w-12"
      />
      <span class="text-xl font-bold text-accent sm:text-2xl">猫&小窝</span>
    </a>

    <!-- Desktop Navigation -->
    <nav
      aria-label="Main menu"
      class="hidden items-center divide-x divide-accent/30 sm:flex"
    >
      {
        menuLinks.map((link) => (
          <a
            href={link.path}
            class="header-link"
            aria-current={Astro.url.pathname === link.path ? "page" : false}
            data-astro-prefetch
          >
            {link.title}
          </a>
        ))
      }
    </nav>
  </div>

  <div class="flex items-center gap-4">
    <Search />
    <ThemeToggle />
    
    <!-- Mobile Toggle Button -->
    <mobile-button class="sm:hidden">
      <button
        id="toggle-navigation-menu"
        type="button"
        aria-label="Toggle navigation menu"
        class="relative h-8 w-8 rounded-lg p-1 hover:bg-accent/10"
      >
        <div class="absolute h-full w-full">
          <div class="absolute left-1/2 top-1/2 h-0.5 w-6 -translate-x-1/2 -translate-y-1/2 transform rounded-full bg-accent transition-all duration-300 group-aria-expanded:rotate-45"></div>
          <div class="absolute left-1/2 top-1/2 h-0.5 w-6 -translate-x-1/2 -translate-y-1/2 transform rounded-full bg-accent transition-all duration-300 group-aria-expanded:-rotate-45"></div>
        </div>
      </button>
    </mobile-button>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu opacity-0 -translate-y-full group-[.menu-open]:opacity-100 group-[.menu-open]:translate-y-0 sm:hidden">
    <nav class="flex flex-col items-center gap-8 text-xl">
      {
        menuLinks.map((link) => (
          <a
            href={link.path}
            class="header-link"
            aria-current={Astro.url.pathname === link.path ? "page" : false}
            data-astro-prefetch
          >
            {link.title}
          </a>
        ))
      }
    </nav>
  </div>
</header>

<script>
  class MobileNavBtn extends HTMLElement {
    connectedCallback() {
      const button = this.querySelector('button');
      const header = document.getElementById('main-header');
      
      button?.addEventListener('click', () => {
        const isOpen = header.classList.toggle('menu-open');
        button.setAttribute('aria-expanded', isOpen.toString());
        
        // 禁用页面滚动
        document.body.style.overflow = isOpen ? 'hidden' : '';
      });
    }
  }

  customElements.define('mobile-button', MobileNavBtn);
</script>
